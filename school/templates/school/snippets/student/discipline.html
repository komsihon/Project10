{% load i18n humanize %}
<div class="discipline-summary subtle-shade" xmlns="http://www.w3.org/1999/html">
    <ul class="discipline-items pull-left">
        {% for item in summary %}
        <li class="discipline-item">
            <label>{{ item.name }} :</label> <span class="text-muted {{ item.slug }}">{{ item.count }}</span>
        </li>
        {% endfor %}
    </ul>
    {% if not settings.IS_UMBRELLA %}
    <div class="actions dropdown" style="cursor: pointer; float: right; margin: -10px 24px 0 0">
        <span class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            <i class="action glyphicon glyphicon-option-vertical text-muted"></i>
        </span>
        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="period">
            <li class="show-modal-discipline-entry">
                <a href="javascript:;">{% trans "Add new entry" %}</a>
            </li>
            <li class="show-modal-discipline-entry parent-convocation">
                <a href="javascript:;" style="color: #e74c3c">{% trans "Summon parent" %}</a>
            </li>
        </ul>
    </div>
    {% endif %}
    {% if not settings.IS_UMBRELLA and user.is_bao %}
    <div style="clear: both; text-align: center">
        <button class="btn btn-danger show-modal-discipline-entry exclusion"
                style="margin: 0 auto 10px;min-width: 240px;">{% trans "Exclude" %}</button>
        <p class="text-muted">{% blocktrans %}
            Exclude this student from school.
        {% endblocktrans %}</p>
        <div class="clearfix"></div>
    </div>
    {% endif %}
    {% if student.is_excluded %}
    <div style="clear: both; text-align: center">
        <p class="text-danger">{% trans "This student has been excluded" %}</p>
        <div class="clearfix"></div>
    </div>
    {% endif %}
    <div class="clearfix"></div>
</div>
<ul class="list-group discipline-log" style="margin-top: 15px">
    {% for entry in discipline_log %}
        <li class="list-group-item ik-li {{ entry.item.slug }}" id="{{ entry.id }}"
            data-id="{{ entry.id }}" data-model-name="school.DisciplineLogEntry">
            <div class="row">
                <div class="col-xs-10">
                    <div class="di-title">
                        <span class="name">{{ entry.item.name }}:</span>
                        <span class="count text-muted">{{ entry.count }} {{ entry.item.unit }}</span>
                        {% if entry.is_justified %}<i class="fa fa-circle justified"></i>{% endif %}
                    </div>
                    <div class="di-details text-muted">{{ entry.details }}</div>
                </div>
                <div class="col-xs-2">
                    <div class="di-happened-on pull-right">{{ entry.happened_on|date }}</div>
                    {% if not settings.IS_UMBRELLA or settings.IS_UMBRELLA and entry.is_justified %}
                    <div class="actions dropdown">
                        <span class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            <i class="action glyphicon glyphicon-option-vertical text-muted"></i>
                        </span>
                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="period">
                            {% if entry.is_justified %}
                                {% if settings.IS_UMBRELLA %}
                                    {% url 'foulassi:show_justificatory' entry.student.school.ikwen_name entry.justificatory.id as show_justificatory_url %}
                                {% else %}
                                    {% url 'school:change_justificatory' entry.justificatory.id as show_justificatory_url %}
                                {% endif %}
                                <li>
                                    <a href="{{ show_justificatory_url }}">{% trans "Show justificatory" %}</a>
                                </li>
                            {% else %}
                                <li class="show-discipline-entry-modal">
                                    <a href="{% url 'school:change_justificatory' %}?entry_id={{ entry.id }}">{% trans "Justify" %}</a>
                                </li>
                            {% endif %}
                            {% if not settings.IS_UMBRELLA %}
                            <li class="trash">
                                <a href="javascript:;" style="color: #e74c3c">{% trans "Delete" %}</a>
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
        </li>
    {% endfor %}
    <li class="list-group-item ik-li di tpl" style="display: none">
        <div class="row">
            <div class="col-xs-10">
                <div class="di-title">
                    <span class="name"></span>:
                    <span class="count text-muted"></span>
                </div>
                <div class="details text-muted"></div>
            </div>
            <div class="col-xs-2">
                <div class="di-happened-on pull-right"></div>
                <div class="actions dropdown" style="cursor: pointer; clear: both; float: right; margin: 0 24px 0 0">
                    <span class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        <i class="action glyphicon glyphicon-option-vertical text-muted"></i>
                    </span>
                    <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="period">
                        <li class="justify">
                            <a href="">{% trans "Justify" %}</a>
                        </li>
                        <li class="trash">
                            <a href="javascript:;" style="color: #e74c3c">{% trans "Delete" %}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </li>
</ul>
<div class="clearfix"></div>

<div class="modal fade" id="modal-add-discipline-entry" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content modal-info">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body">
                <div class="form-group discipline-item-id">
                    <label for="discipline-item-id">{% trans "Type" %}</label>
                    <select id="discipline-item-id" class="form-control input-sm">
                        {% for item in discipline_item_list %}
                            <option value="{{ item.id }}">{{ item.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group discipline-item-count">
                    <label for="discipline-item-count">{% trans "Count" %}</label>
                    <input type="number" id="discipline-item-count" step="0.5" value="1" class="form-control input-sm" />
                </div>
                <div class="form-group discipline-item-happened-on">
                    <label for="discipline-item-happened-on">{% trans "Date" %}</label>
                    <input type="hidden" id="happened-on-alt" />
                    <input type="text" id="discipline-item-happened-on" class="form-control input-sm" />
                </div>
                <div class="form-group" style="margin-top: 15px">
                    <label for="discipline-item-details">{% trans 'Details' %}</label>
                    <textarea id="discipline-item-details" class="form-control"
                              style="height: 120px"></textarea>
                </div>
                <div class="send-sms checkbox">
                    <label for="send-sms">
                        <input type="checkbox" id="send-sms">{% trans "Send SMS to parents" %} ?
                        <span>
                            <strong>{{ balance.sms_count }}</strong>
                            <em class="text-muted">{% trans "Credits remaining" %}</em>
                        </span>
                    </label>
                </div>
                <div class="sms-widget" style="margin-top: 15px">
                    <div>
                        <div class="sms-recipient">
                            {% for parent in student.parent_set.all %}
                            <label>
                                <input type="checkbox" value="{{ parent.phone }}" checked class="input-md">
                                <span class="sms-contact">
                                    <span class="sms-phone">{{ parent.phone }}</span>
                                    <span class="text-muted">({{ parent.relation }})</span>
                                </span>
                            </label>
                            {% endfor %}
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="form-group">
                        <label for="sms-notification">{% trans 'SMS' %}</label>
                        <textarea id="sms-notification" class="sms-text form-control"
                                  style="height: 120px"></textarea>
                    </div>
                    <div>
                        <span class="pull-left sms-char-count text-muted">151</span>
                        <span class="text-center pull-left" style="width: 30px">-</span>
                        <span class="pull-left sms-page-count">1/3</span>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="actions">
                    <div class="col-xs-12 col-sm-4 col-md-3 pull-right">
                        <button class="btn btn-sm btn-success btn-block add-discipline-log-entry"
                                data-dismiss="modal" aria-label="Close">{% trans "OK" %}</button>
                    </div>
                    <div class="col-xs-12 col-sm-4 col-md-3 pull-right">
                        <button class="btn btn-sm btn-default btn-block"
                                data-dismiss="modal" aria-label="Close">{% trans "Cancel" %}</button>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>

<script>
    (function() {
        $('#discipline-item-happened-on').datepicker({
            altField: "#happened-on-alt",
            altFormat: "yy-mm-dd"
        });
        /*$('#send-sms').click(function() {
            $('.sms-widget').toggleClass('disclosed');
        });*/
    })()
</script>